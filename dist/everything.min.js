"use strict";angular.module("myApp",[]).factory("gameLogic",function(){function a(){return[["","","","","","","","","","",""],["","","","","","","","","","",""],["","","","","","","","","","",""],["","","","","","","","","","",""],["","","","","","","","","","",""],["","","","","","","","","","",""],["","","","","","","","","","",""],["","","","","","","","","","",""],["","","","","","","","","","",""],["","","","","","","","","","",""],["","","","","","","","","","",""]]}function b(a,b,c){var d=[];d.push([b,c]);var e=[];for(e[[b,c]]=[[-1,-1]];d.length>0;){var g=d.shift(),h=f(a,g[0],g[1]);for(var i in h)h[i]in e==0&&(d.push(h[i]),e[h[i]]=g)}return e}function c(a,c,d,e){var f=b(a,c,d,e),g=Object.keys(f);for(var h in g){var i=g[h],d=i.split(",");if(10==d[1])return!0}return!1}function d(a,c,d,e){var f=b(a,c,d,e),g=Object.keys(f);for(var h in g){var i=g[h],d=i.split(",");if(10==d[0])return!0}return!1}function e(a){for(var b=0;11>b;b++)if("B"==a[b][0]&&c(a,b,0,"B"))return"B";for(var e=0;11>e;e++)if("R"==a[0][e]&&d(a,0,e,"R"))return"R";return""}function f(a,b,c){var d=[];return g(b-1)&&g(c)&&a[b-1][c]===a[b][c]&&d.push([b-1,c]),g(b-1)&&g(c+1)&&a[b-1][c+1]===a[b][c]&&d.push([b-1,c+1]),g(b)&&g(c-1)&&a[b][c-1]==a[b][c]&&d.push([b,c-1]),g(b)&&g(c+1)&&a[b][c+1]==a[b][c]&&d.push([b,c+1]),g(b+1)&&g(c-1)&&a[b+1][c-1]==a[b][c]&&d.push([b+1,c-1]),g(b+1)&&g(c)&&a[b+1][c]==a[b][c]&&d.push([b+1,c]),d}function g(a){return a>=0&&11>a?!0:!1}function h(a,b){var c,d,e=[];for(c=0;11>c;c++)for(d=0;11>d;d++)try{e.push(i(a,c,d,b))}catch(f){}return e}function i(b,c,d,f){if(void 0===b&&(b=a()),""!=b[c][d])throw new Error("The position is not empty!");if(""!=e(b))throw new Error("The game has ended already!");var g=angular.copy(b);g[c][d]=0===f?"R":"B";var h,i=e(g);return h=""!=i?{endMatch:{endMatchScores:"R"===i?[1,0]:"B"===i?[0,1]:[0,0]}}:{setTurn:{turnIndex:1-f}},[h,{set:{key:"board",value:g}},{set:{key:"delta",value:{row:c,col:d}}}]}function j(a){var b=a.move,c=a.turnIndexBeforeMove,d=a.stateBeforeMove;try{var e=b[2].set.value,f=e.row,g=e.col,h=d.board,j=i(h,f,g,c);if(!angular.equals(b,j))return!1}catch(k){return!1}return!0}return{getInitialBoard:a,getPossibleMoves:h,createMove:i,checkWinner:b,getHorizontalWin:c,getVerticalWin:d,getWinner:e,isMoveOk:j}}),angular.module("myApp").controller("Ctrl",["$scope","$rootScope","$log","$timeout","gameService","stateService","gameLogic","resizeGameAreaService",function(a,b,c,d,e,f,g,h){function i(b,c,d){var e=c-y.offsetLeft,f=d-y.offsetTop;console.log("old xy=",e,",",f);var g=document.getElementById("e2e_test_div_0x0").offsetLeft,h=document.getElementById("e2e_test_div_0x0").offsetTop;console.log("left top = ",g),console.log("left top = ",h),e-=g,f-=h,console.log("x,y=",e,",",f);var i=document.getElementById("border").width,j=document.getElementById("border").height;if(0>e||0>f||e>=i||f>=j||g>e)return x.style.display="none",void(u.style.display="none");x.style.display="inline",u.style.display="inline";var m=document.getElementById("hexagon").height/2,n=Math.floor(A*e/i),p=Math.floor(z*f/j),q=n,r=p;p=Math.floor((e*Math.sqrt(3)/3-f/3)/m),n=Math.floor(2*f/3/m),console.log("old=",r,",",q);var s=document.getElementById("hexagon").clientWidth/2;console.log("RADIUS=",s);{var t=1.5*s,B=Math.floor(e/t),C=document.getElementById("hexagon").height,D=f-B%2*C/2;Math.floor(D/C)}e=(e-s)/document.getElementById("hexagon").clientWidth;var E=f/s,F=Math.floor(e+E),G=Math.floor((Math.floor(E-e)+F)/3),H=Math.floor((Math.floor(2*e+1)+F)/3)-G;p=G,n=H;var I;I=p-1==0?n+1:p-1==1?n+1:p-1==2||p-1==3?n+2:p-1==4||p-1==5?n+3:p-1==6||p-1==7?n+4:p-1==8||p-1==9?n+5:n+6,(n>11||p>11)&&console.log("wrong col = ",n);var J=l(p,I);console.log(J),w.setAttribute("x1",J.x);l(10,n+1);w.setAttribute("x2",J.x),v.setAttribute("y1",J.y),v.setAttribute("y2",J.y),1===a.turnIndex?(v.setAttribute("stroke","blue"),w.setAttribute("stroke","blue")):(v.setAttribute("stroke","red"),w.setAttribute("stroke","red"));var K=("rotate(-34.5 "+Math.floor(J.x)+" "+Math.floor(J.y)+")",k(p,I));return x.style.left=K.left+"px",x.style.top=K.top+"px",2>p&&p>9?(u.style.display="none",void(x.style.display="none")):void(("touchend"===b||"touchcancel"===b||"touchleave"===b||"mouseup"===b)&&(x.style.display="none",u.style.display="none",o(p-1,n-1)))}function j(){{var a=(document.getElementById("border").width-5,document.getElementById("border").height),b=document.getElementById("hexagon").width;document.getElementById("hexagon").height}return{width:b,height:a/z}}function k(a,b){var c=j();if(a%2==0)var d=b*c.width+c.width/2;else var d=b*c.width;return{top:a*c.height,left:d}}function l(a,b){var c=j();if(a%2==1)var d=b*c.width+c.width/2;else var d=b*c.width+c.width;return{x:d,y:a*c.height+c.height/2}}function m(){var b=g.getPossibleMoves(a.board,a.turnIndex),c=Math.floor(Math.random()*b.length);e.makeMove(b[c])}function n(b){a.board=b.stateAfterMove.board,a.delta=b.stateAfterMove.delta,void 0===a.board&&(a.board=g.getInitialBoard()),a.isYourTurn=b.turnIndexAfterMove>=0&&b.yourPlayerIndex===b.turnIndexAfterMove,a.turnIndex=b.turnIndexAfterMove,a.isYourTurn&&""===b.playersInfo[b.yourPlayerIndex].playerId&&(console.log("computer turn"),a.isYourTurn=!1,d(m,500))}function o(d,e){b.$apply(function(){var b="Dragged to "+d+"x"+e;c.info(b),a.msg=b,a.cellClicked(d,e)})}function p(a){var b=a.changedTouches[0];t(a,a.type,b.clientX,b.clientY)}function q(a){B=!0,t(a,"touchstart",a.clientX,a.clientY)}function r(a){B&&t(a,"touchmove",a.clientX,a.clientY)}function s(a){B=!1,t(a,"touchend",a.clientX,a.clientY)}function t(a,b,c,d){a.preventDefault(),console.log("handleDragEvent:",b,c,d),i(b,c,d)}h.setWidthToHeight(1),a.numbersTo=function(a,b){for(var c=[],d=a;b>d;d++)c[d]=d;return c},a.getStyle=function(b,c){var d=a.board[b][c];return"R"===d?{"-webkit-animation":"moveAnimation 2s",animation:"moveAnimation 2s"}:"B"===d?{"-webkit-animation":"moveAnimation 2s",animation:"moveAnimation 2s"}:{}};var u=document.getElementById("draggingLines"),v=document.getElementById("horizontalDraggingLine"),w=document.getElementById("verticalDraggingLine"),x=document.getElementById("clickToDragPiece"),y=document.getElementById("gameArea"),z=13,A=11;window.handleDragEvent=i,a.cellClicked=function(b,d){if(c.info(["Clicked on cell:",b,d]),"?throwException"===window.location.search)throw new Error("Throwing the error because URL has '?throwException'");if(a.isYourTurn)try{var f=g.createMove(a.board,b,d,a.turnIndex);a.isYourTurn=!1,e.makeMove(f)}catch(h){return void c.info(["Cell is already full in position:",b,d])}},a.shouldShowImage=function(b,c){var d=a.board[b][c];return""!==d},a.isPieceR=function(b,c){return"R"===a.board[b][c]},a.isPieceB=function(b,c){return"B"===a.board[b][c]},a.getImageSrc=function(b,c){var d=a.board[b][c];return"R"===d?"imgs/R.png":"B"===d?"imgs/B.png":""},a.shouldSlowlyAppear=function(b,c){return void 0!==a.delta&&a.delta.row===b&&a.delta.col===c},a.getPreviewSrc=function(){return 1===a.turnIndex?"imgs/B.png":"imgs/R.png"},a.rowsNum=z,a.colsNum=A;var B=!1;document.addEventListener("touchstart",p,!0),document.addEventListener("touchmove",p,!0),document.addEventListener("touchend",p,!0),document.addEventListener("touchcancel",p,!0),document.addEventListener("touchleave",p,!0),document.addEventListener("mousedown",q,!0),document.addEventListener("mousemove",r,!0),document.addEventListener("mouseup",s,!0),e.setGame({gameDeveloperEmail:"npb245@nyu.edu",minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:g.isMoveOk,updateUI:n})}]);
//# sourceMappingURL=everything.min.js.map