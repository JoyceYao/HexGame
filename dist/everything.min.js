"use strict";angular.module("myApp",["ngTouch","ui.bootstrap"]).factory("gameLogic",function(){function a(){return[["","","","","","","","","","",""],["","","","","","","","","","",""],["","","","","","","","","","",""],["","","","","","","","","","",""],["","","","","","","","","","",""],["","","","","","","","","","",""],["","","","","","","","","","",""],["","","","","","","","","","",""],["","","","","","","","","","",""],["","","","","","","","","","",""],["","","","","","","","","","",""]]}function b(a,b,c){var d=[];d.push([b,c]);var e=[];for(e[[b,c]]=[[-1,-1]];d.length>0;){var g=d.shift(),h=f(a,g[0],g[1]);for(var i in h)h[i]in e==0&&(d.push(h[i]),e[h[i]]=g)}return e}function c(a,c,d,e){var f=b(a,c,d,e),g=Object.keys(f);for(var h in g){var i=g[h],d=i.split(",");if(10==d[1])return!0}return!1}function d(a,c,d,e){var f=b(a,c,d,e),g=Object.keys(f);for(var h in g){var i=g[h],d=i.split(",");if(10==d[0])return!0}return!1}function e(a){for(var b=0;11>b;b++)if("B"==a[b][0]&&c(a,b,0,"B"))return"B";for(var e=0;11>e;e++)if("R"==a[0][e]&&d(a,0,e,"R"))return"R";return""}function f(a,b,c){var d=[];return g(b-1)&&g(c)&&a[b-1][c]===a[b][c]&&d.push([b-1,c]),g(b-1)&&g(c+1)&&a[b-1][c+1]===a[b][c]&&d.push([b-1,c+1]),g(b)&&g(c-1)&&a[b][c-1]==a[b][c]&&d.push([b,c-1]),g(b)&&g(c+1)&&a[b][c+1]==a[b][c]&&d.push([b,c+1]),g(b+1)&&g(c-1)&&a[b+1][c-1]==a[b][c]&&d.push([b+1,c-1]),g(b+1)&&g(c)&&a[b+1][c]==a[b][c]&&d.push([b+1,c]),d}function g(a){return a>=0&&11>a?!0:!1}function h(a,b){var c,d,e=[];for(c=0;11>c;c++)for(d=0;11>d;d++)try{e.push(i(a,c,d,b))}catch(f){}return e}function i(b,c,d,f){if(void 0===b&&(b=a()),""!=b[c][d])throw new Error("The position is not empty!");if(""!=e(b))throw new Error("The game has ended already!");var g=angular.copy(b);g[c][d]=0===f?"R":"B";var h,i=e(g);return h=""!=i?{endMatch:{endMatchScores:"R"===i?[1,0]:"B"===i?[0,1]:[0,0]}}:{setTurn:{turnIndex:1-f}},[h,{set:{key:"board",value:g}},{set:{key:"delta",value:{row:c,col:d}}}]}function j(a){var b=a.move,c=a.turnIndexBeforeMove,d=a.stateBeforeMove;try{var e=b[2].set.value,f=e.row,g=e.col,h=d.board,j=i(h,f,g,c);if(!angular.equals(b,j))return!1}catch(k){return!1}return!0}return{getInitialBoard:a,getPossibleMoves:h,createMove:i,checkWinner:b,getHorizontalWin:c,getVerticalWin:d,getWinner:e,isMoveOk:j}}),angular.module("myApp").controller("Ctrl",["$scope","$rootScope","$log","$timeout","gameService","stateService","gameLogic","aiService","resizeGameAreaService","dragAndDropService",function(a,b,c,d,e,f,g,h,i,j){function k(b,c,d){var e=c-w.offsetLeft,f=d-w.offsetTop;console.log("old xy=",e,",",f);var g=document.getElementById("e2e_test_div_0x0").offsetLeft,h=document.getElementById("e2e_test_div_0x0").offsetTop;console.log("left top = ",g),console.log("left top = ",h),e-=g,f-=h,console.log("x,y=",e,",",f);var i=document.getElementById("border").width,j=document.getElementById("border").height;if(0>e||0>f||e>=i||f>=j||g>e)return v.style.display="none",void(s.style.display="none");v.style.display="inline",s.style.display="inline";var k=document.getElementById("hexagon").height/2,m=Math.floor(y*e/i),p=Math.floor(x*f/j);p=Math.floor((e*Math.sqrt(3)/3-f/3)/k),m=Math.floor(2*f/3/k);var q=document.getElementById("hexagon").clientWidth/2;console.log("RADIUS=",q);{var z=1.5*q,A=Math.floor(e/z),B=document.getElementById("hexagon").height,C=f-A%2*B/2;Math.floor(C/B)}e=(e-q)/document.getElementById("hexagon").clientHeight;var D=f/q,E=Math.floor(e+D),F=Math.floor((Math.floor(D-e)+E)/3),G=Math.floor((Math.floor(2*e+1)+E)/3)-F;p=F,m=G;var H=l(p,m);console.log("row col = ",p," ",m),(m>12||0>=m)&&(console.log("wrong col = ",m),s.style.display="none",v.style.display="none");var I=o(p,H),J=o(0,H);console.log(I),u.setAttribute("x1",I.x),u.setAttribute("y1",J.y);var K=o(12,m);u.setAttribute("x2",I.x),u.setAttribute("y2",K.y);var L=o(p,l(p,0)),M=o(p,l(p,12));t.setAttribute("x1",L.x),t.setAttribute("x2",M.x),t.setAttribute("y1",I.y),t.setAttribute("y2",I.y),1===a.turnIndex?(t.setAttribute("stroke","blue"),u.setAttribute("stroke","blue")):(t.setAttribute("stroke","red"),u.setAttribute("stroke","red"));var N="rotate(-34.5 "+Math.floor(I.x)+" "+Math.floor(I.y)+")";u.setAttribute("transform",N);var O=n(p,H);return v.style.left=O.left+"px",v.style.top=O.top+"px",2>p&&p>9?(s.style.display="none",void(v.style.display="none")):void(("touchend"===b||"touchcancel"===b||"touchleave"===b||"mouseup"===b)&&(v.style.display="none",s.style.display="none",r(p-1,m-1)))}function l(a,b){var c;return c=a-1===0?b+1:a-1===1?b+1:a-1===2||a-1===3?b+2:a-1===4||a-1===5?b+3:a-1===6||a-1===7?b+4:a-1===8||a-1===9?b+5:b+6}function m(){{var a=(document.getElementById("border").width-5,document.getElementById("border").height),b=document.getElementById("hexagon").width;document.getElementById("hexagon").height}return{width:b,height:a/x}}function n(a,b){var c,d=m();return c=a%2===0?b*d.width+d.width/2:b*d.width,{top:a*d.height,left:c}}function o(a,b){var c,d=m();return c=a%2===1?b*d.width+d.width/2:b*d.width+d.width,{x:c,y:a*d.height+d.height/2}}function p(){var b=g.getPossibleMoves(a.board,a.turnIndex),c=Math.floor(Math.random()*b.length);e.makeMove(b[c])}function q(b){a.board=b.stateAfterMove.board,a.delta=b.stateAfterMove.delta,void 0===a.board&&(a.board=g.getInitialBoard()),a.isYourTurn=b.turnIndexAfterMove>=0&&b.yourPlayerIndex===b.turnIndexAfterMove,a.turnIndex=b.turnIndexAfterMove,a.isYourTurn&&""===b.playersInfo[b.yourPlayerIndex].playerId&&(console.log("computer turn"),a.isYourTurn=!1,d(p,500))}function r(d,e){b.$apply(function(){var b="Dragged to "+d+"x"+e;c.info(b),a.msg=b,a.cellClicked(d,e)})}i.setWidthToHeight(1),a.numbersTo=function(a,b){for(var c=[],d=a;b>d;d++)c[d]=d;return c},a.getStyle=function(b,c){var d=a.board[b][c];return"R"===d?{"-webkit-animation":"moveAnimation 2s",animation:"moveAnimation 2s"}:"B"===d?{"-webkit-animation":"moveAnimation 2s",animation:"moveAnimation 2s"}:{}};var s=document.getElementById("draggingLines"),t=document.getElementById("horizontalDraggingLine"),u=document.getElementById("verticalDraggingLine"),v=document.getElementById("clickToDragPiece"),w=document.getElementById("gameArea"),x=13,y=11;j.addDragListener("gameArea",k),a.cellClicked=function(b,d){if(c.info(["Clicked on cell:",b,d]),"?throwException"===window.location.search)throw new Error("Throwing the error because URL has '?throwException'");if(a.isYourTurn)try{var f=g.createMove(a.board,b,d,a.turnIndex);a.isYourTurn=!1,e.makeMove(f)}catch(h){return void c.info(["Cell is already full in position:",b,d])}},a.shouldShowImage=function(b,c){var d=a.board[b][c];return""!==d},a.isPieceR=function(b,c){return"R"===a.board[b][c]},a.isPieceB=function(b,c){return"B"===a.board[b][c]},a.getImageSrc=function(b,c){var d=a.board[b][c];return"R"===d?"imgs/R.png":"B"===d?"imgs/B.png":""},a.getPreviewSrc=function(){return 1===a.turnIndex?"imgs/B.png":"imgs/R.png"},a.rowsNum=x,a.colsNum=y,e.setGame({gameDeveloperEmail:"npb245@nyu.edu",minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:g.isMoveOk,updateUI:q})}]),angular.module("myApp").factory("aiService",["alphaBetaService","gameLogic",function(a,b){function c(b,c,g){return a.alphaBetaDecision([null,{set:{key:"board",value:b}}],c,e,d,"?debug"===window.location.search?f:null,g)}function d(a){if(a[0].endMatch){var b=a[0].endMatch.endMatchScores;return b[0]>b[1]?Number.POSITIVE_INFINITY:b[0]<b[1]?Number.NEGATIVE_INFINITY:0}return 0}function e(a,c){return b.getPossibleMoves(a[1].set.value,c)}function f(a){return"\n"+a[1].set.value.join("\n")+"\n"}return{createComputerMove:c}}]);
//# sourceMappingURL=everything.min.js.map